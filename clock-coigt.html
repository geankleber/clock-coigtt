<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relógio time.is</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
        }
        
        .clock-container {
            text-align: center;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        #clock {
            font-size: 3.5rem;
            font-weight: bold;
            color: #333;
            margin: 15px 0;
        }
        
        #date {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }
        
        #timezone {
            font-size: 1rem;
            color: #888;
        }
        
        .sync-status {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="clock-container">
        <div id="clock">--:--:--</div>
        <div id="date">--</div>
        <div id="timezone">--</div>
        <div class="sync-status">
            <span id="sync-message">Sincronizando...</span>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos do DOM
            const clockElement = document.getElementById('clock');
            const dateElement = document.getElementById('date');
            const timezoneElement = document.getElementById('timezone');
            const syncMessageElement = document.getElementById('sync-message');
            
            // Variáveis para sincronização
            let serverTimeOffset = 0;
            let syncComplete = false;
            let lastSyncTime = 0;
            
            // Função para sincronizar com o servidor time.is
            const syncWithServer = async () => {
                try {
                    // Registra o tempo local antes da requisição
                    const localTimeBeforeRequest = Date.now();
                    
                    // Faz a requisição para o site time.is
                    const response = await fetch('https://time.is/', {
                        method: 'GET',
                        mode: 'cors',  // Necessário para requisições cross-origin
                        cache: 'no-store' // Evita caching
                    });
                    
                    // Registra o tempo local após a requisição
                    const localTimeAfterRequest = Date.now();
                    
                    // Estima o tempo de ida e volta (RTT)
                    const rtt = localTimeAfterRequest - localTimeBeforeRequest;
                    
                    // Extrai o cabeçalho Date da resposta
                    const serverTimeStr = response.headers.get('Date');
                    const serverTime = new Date(serverTimeStr).getTime();
                    
                    // Calcula o offset entre o servidor e o cliente
                    // Considerando metade do RTT como tempo aproximado de ida
                    serverTimeOffset = serverTime - (localTimeBeforeRequest + rtt/2);
                    
                    // Atualiza status
                    syncComplete = true;
                    lastSyncTime = Date.now();
                    syncMessageElement.textContent = 'Sincronizado com time.is';
                    
                    // Atualiza o relógio imediatamente
                    updateClock();
                    
                    console.log(`Sincronizado. Offset: ${serverTimeOffset}ms, RTT: ${rtt}ms`);
                } catch (error) {
                    // Em caso de erro na sincronização
                    console.error('Erro ao sincronizar com time.is:', error);
                    syncMessageElement.textContent = 'Usando hora local (falha na sincronização)';
                    
                    // Tenta novamente após 30 segundos
                    setTimeout(syncWithServer, 30000);
                }
            };
            
            // Função para atualizar o relógio
            const updateClock = () => {
                // Calcula a hora do servidor atual
                const now = new Date(Date.now() + serverTimeOffset);
                
                // Formata a hora
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                
                // Atualiza o display do relógio
                clockElement.textContent = `${hours}:${minutes}:${seconds}`;
                
                // Formata e exibe a data
                const options = { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                };
                dateElement.textContent = now.toLocaleDateString('pt-BR', options);
                
                // Exibe informações do fuso horário
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                timezoneElement.textContent = `${timeZone} (UTC${formatUTCOffset(now)})`;
            };
            
            // Formatar o offset UTC 
            const formatUTCOffset = (date) => {
                const offset = date.getTimezoneOffset() * -1; // converte para padrão positivo/negativo
                const hours = Math.abs(Math.floor(offset / 60));
                const minutes = Math.abs(offset % 60);
                return `${offset >= 0 ? '+' : '-'}${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            };
            
            // Sincronização periódica (a cada 10 minutos)
            const startPeriodicSync = () => {
                syncWithServer();
                setInterval(() => {
                    syncWithServer();
                }, 600000); // 10 minutos
            };
            
            // Atualização do relógio (a cada segundo)
            const startClock = () => {
                setInterval(() => {
                    updateClock();
                }, 1000);
            };
            
            // Inicia o relógio
            startPeriodicSync();
            startClock();
        });
    </script>
</body>
</html>
